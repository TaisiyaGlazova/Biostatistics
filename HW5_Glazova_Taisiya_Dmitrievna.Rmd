---
title: "Glazova_Taisiya_Dmitrievna_HW5"
output: html_document
date: "2024-04-10"
---

```{r}
library(tidyverse)
library(survival)
library(ggsurvfit)
library(survminer)
```

### Загрузка данных

```{r}
df_cancer <- read.csv("wisconsin_breast_cancer.csv")

# Преобразуем диагноз в числовой формат
df_cancer_mode <- df_cancer %>%
  mutate(diagnosis = ifelse(diagnosis == "M", 1, 0))

```

# Задание 1

## (a)

Создадим регрессионную модель, которая бы описывала связь среднего радиуса опухоли и средней площади

```{r echo=TRUE}
model_lm_a <- lm(radius_mean ~ area_mean, df_cancer_mode)
model_lm_a  %>% summary()
```

**Вывод**: Поскольку p-value меньше 0.05, мы может отвергнуть нулевую гипотезу об отсутствии связи между средним радиусом и средней площадью опухоли.

```{r echo=TRUE}
# Построим график, на котором отражена регрессионная прямая
plot(df_cancer_mode$area_mean,
    df_cancer_mode$radius_mean, 
    xlab = "Средняя площадь", ylab = "Средний радиус опухоли", 
     main = "Регрессионная модель: Средняя площадь")

# Добавляем регрессионную прямую
abline(model_lm_a, col = "red")

```

**Вывод**: На графике мы можем заметить, что связь между средним радиусом и средней площадью опухоли положительная: с ростом площади увеличивается и радиус. На отрезке [500; 1500] по оси Ох наблюдается сильная связь между переменными, данные хорошо соответсвуют модели.

## (б)

Создадим регрессионную модель, которая бы описывала связь среднего радиуса опухоли и среднего периметра

```{r echo=TRUE}
model_lm_b <- lm(radius_mean ~ perimeter_mean, df_cancer_mode)
model_lm_b  %>% summary()
```

**Вывод**: Поскольку p-value меньше 0.05, мы может отвергнуть нулевую гипотезу об отсутствии связи между средним радиусом и средним периметром опухоли.

```{r echo=TRUE}
# Построим график, на котором отражена регрессионная прямая
plot(df_cancer_mode$perimeter_mean,
    df_cancer_mode$radius_mean, 
    xlab = "Средний периметр", ylab = "Средний радиус опухоли", 
     main = "Регрессионная модель: Средний периметр")

# Добавляем регрессионную прямую
abline(model_lm_b, col = "red")

```

**Вывод**: На графике мы можем заметить, что связь между седним радиусом и средним периметром опухоли положительная: с увеличением периметра увеличивается и радиус. На всей области графика наблюдается сильная связь между переменными, данные хорошо соответсвуют модели.

## (в)

Создадим регрессионную модель, которая бы описывала связь среднего радиуса опухоли и средней симметричности

```{r echo=TRUE}
model_lm_v <- lm(radius_mean ~ symmetry_mean, df_cancer_mode)
model_lm_v  %>% summary()
```

**Вывод**: Поскольку p-value меньше 0.05, мы может отвергнуть нулевую гипотезу об отсутствии связи между средним радиусом и средней симмемтричностью опухоли.

```{r echo=TRUE}
# Построим график, на котором отражена регрессионная прямая
plot(df_cancer_mode$symmetry_mean,
    df_cancer_mode$radius_mean, 
    xlab = "Средняя симметричность", ylab = "Средний радиус опухоли", 
     main = "Регрессионная модель: Средняя симметричность")

# Добавляем регрессионную прямую
abline(model_lm_v, col = "red")

```

**Вывод**: На графике мы можем заметить, что связь между седним радиусом и средней симметричностью опухоли положительная. Однако значения сильно разбросаны и плохо подчиняются линейному шаблону.

# Задание 2

## (а)

Построим модель, которая прогнозирует вероятность возникновения злокачественной опухоли от среднего радиуса

```{r echo=TRUE}
model_glm_a <- glm(diagnosis ~ radius_mean, df_cancer_mode, family = binomial)
model_glm_a  %>% summary()


# Построим график
plot(df_cancer_mode$radius_mean, model_glm_a$fitted.values, 
     xlab = "Средний радиус", ylab = "Вероятность злокачественной опухоли", 
     main = "Вероятность злокачественной опухоли от среднего радиуса")

```

## (б)

Построим модель, которая прогнозирует вероятность возникновения злокачественной опухоли от средней площади

```{r echo=TRUE}
model_glm_b <- glm(diagnosis ~ area_mean, df_cancer_mode, family = binomial)
model_glm_b  %>% summary()

```

```{r echo=TRUE}
# Построим график
plot(df_cancer_mode$area_mean, model_glm_b$fitted.values, 
     xlab = "Средняя площадь", ylab = "Вероятность злокачественной опухоли", 
     main = "Вероятность злокачественной опухоли от средней площади")

```

## (в)

Построим модель, которая прогнозирует вероятность возникновения злокачественной опухоли от средней текстуры

```{r echo=TRUE}
model_glm_v <- glm(diagnosis ~ texture_mean, df_cancer_mode, family = binomial)
model_glm_v  %>% summary()

```

```{r echo=TRUE}
# Построим график
plot(df_cancer_mode$texture_mean, model_glm_v$fitted.values, 
     xlab = "Средняя текстура", ylab = "Вероятность злокачественной опухоли", 
     main = "Вероятность злокачественной опухоли от средней текстуры")

```

## (г)

Построим модель, которая прогнозирует вероятность возникновения злокачественной опухоли от всех трёх перечисленных факторов

```{r echo=TRUE}
model_glm_g <- glm(diagnosis ~ radius_mean + area_mean + texture_mean, 
             data = df_cancer_mode, family = "binomial")

summary(model_glm_g)

```

**Вывод**: Видим, что единственным значимым предиктором при построении такой модели оказывается средняя текстура опухоли (p-value \< 0.05)

# Задание 3

### Датасет

```{r}

df_lung <- lung
# Создаём признак event(1 - наличие события, 0 - отсутствие события)
df_lung <- df_lung  %>%
  mutate(event = ifelse(status == 1, 0, 1))
```

## Построим кривые выживаемости в зависимости от пола

```{r echo=TRUE}
# Функция выживаемости
surv_fit <- survfit2(Surv(time, event) ~ sex, data = df_lung)

# Лог-ранг тест
survdiff(Surv(time, event) ~ sex, data = df_lung)

# Построим кривые выживаемости
ggsurvplot(surv_fit,
           conf.int = TRUE,
           surv.median.line = "hv",
           risk.table = TRUE,
           pval = TRUE,
           pval.method = TRUE
           )
  
```

**Вывод**: p-value лог-рангового теста меньше 0.05, следовательно мы отвергаем нулевую гипотезу в пользу альтернативной: Существует разница в выживаемости между женщинами и мужчинами. По графику видим, что риск умереть у мужчин выше, чем у женщин

## Построим график кумулятивной функции рисков для пола

```{r echo=TRUE}
surv_fit %>% 
  ggsurvfit(type = "cumhaz") +
  labs(
    x = "Дни",
    y = "Кумулятивная опасность"
  ) + 
  add_confidence_interval() +
  add_risktable()

```

**Вывод**: График кумулятивной функции риска для мужчин находится выше графика для женщин, это говорит о более высоком кумулятивном риске смерти для мужчин. Однако к концу периода наблюдения доверительные интервалы обеих групп сильно пересекаются, поэтому можно сказать, что кумулятивный риск обеих групп становится одинаково высок.

## Построим регрессию Кокса

```{r echo=TRUE}
cox <- coxph(Surv(time, event) ~ sex, data = df_lung)
summary(cox)
```

**Вывод**: exp(coef)\<1, следовательно, риск смерти у женщин меньше, чем у мужчин. p-value\<0.05, следовательно, мы отвергаем нулевую гипотезу в пользу альтернативной: пол влият на риск наступления смерти.
