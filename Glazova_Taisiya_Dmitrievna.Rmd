---
title: "Glazova_Taisiya_Dmitrievna"
output: html_document
date: "2024-04-03"
---

## Загрузка библиотек

```{r}
library(tidyverse)
library(qqplotr)
library(car)
```

## Задание 1

Для проверки гипотезы о том, что внедрение нового препарата в среднем лучше снижает давление по сравнению со стандартной терапией, можно использовать непарный t-тест Стьюдента. Это параметрический тест для сранения средних значений двух независимых выборок с нормальным рапределением.

```{r}

# Задаём seed для воспроизводимости результатов
set.seed(45)

# Задаём размер выборки
sample_size <- 30

# Задаём значение среднего артериального давления до приёма нового препарата и после
mean_pressure_before <- 155
mean_pressure_after <- 140

# Формулируем нулевую и альтернативную гипотезу
H0 <- "Среднее артериальное давление до приема нового препарата равно среднему артериальному давлению после приема."
H1 <- "Среднее артериальное давление после приема нового препарата меньше, чем среднее артериальное давление до приема."

# Определяем уровень значимости
alpha <- 0.05

# Проводим статитический тест
t_test_result <- t.test(rnorm(sample_size, mean_pressure_before), rnorm(sample_size, mean_pressure_after), alternative = "less")

# Наблюдаемое значение статистики
t_observed <- t_test_result$statistic

# Критическое значение статистики
t_critical <- qt(alpha, df = sample_size - 1, lower.tail = TRUE)

# Оцениваем статистическую значимость
if (t_observed < t_critical) {
  cat("Принимаем нулевую гипотезу. Вывод:", H0)
} else {
  cat("Отклоняем нулевую гипотезу в пользу альтернативной гипотезы. Вывод:", H1)
}

# Выводим наблюдаемое значение статистики и критическое значение статистики
cat("\n\nНаблюдаемое значение статистики:", t_observed)
cat("\nКритическое значение статистики:", t_critical)

```

## Задание 2

```{r}

# Задаём seed для воспроизводимости результатов
set.seed(123)

# Задаём вероятность заболеть раком лёгких в каждой группе
prob_smoker <- 0.8
prob_nonsmoker <- 0.2

# Задаём размер выборки для обоих случаев
sample_size1 <- 100
sample_size2 <- 30

# Генерируем переменную по курению (1 - курящий, 0 - некурящий) для обоих случаев
smokers1 <- rbinom(sample_size1, 1, 0.5)
smokers2 <- rbinom(sample_size2, 1, 0.5)

# Генерируем переменную о наличии рака лёгких
lung_cancer1 <- rbinom(sample_size1, 1, ifelse(smokers1 == 1, prob_smoker, prob_nonsmoker))
lung_cancer2 <- rbinom(sample_size2, 1, ifelse(smokers2 == 1, prob_smoker, prob_nonsmoker))

# Формулируем нулевую и альтернативную гипотезу
H0 <- "Связи между курением и развитием рака лёгких нет"
H1 <- "Есть связь между курением и развитием рака лёгких."

# Определяем уровень значимости
alpha <- 0.05

```

Создаём таблицу сопряжённости для 1ой выборки

```{r echo=TRUE}
contingency_table1 <- table(smokers1, lung_cancer1)
contingency_table1
```

Объём 1ой выборки большой, в каждой ячейке таблицы сопряжённости есть хотя бы 5 элементов. Для проверки гипотезы о том, что курение влияет на развитие рака лёгких можно использовать критерий хи-квадрат. Это критерий, который помогает оценить статистическую значимость двух или нескольких относительных показателей.

```{r}

chi_squared_test1 <- chisq.test(contingency_table1)

# Наблюдаемое значение статистики хи-квадрат
observed_value1 <- chi_squared_test1$statistic

# Критическое значение статистики хи-квадрат
critical_value1 <- qchisq(1 - alpha, df = min(nrow(table1) - 1, ncol(table1) - 1))

cat("Для первой выборки:\n")

# Оцениваем статистическую значимость
if (observed_value1 > critical_value) {
  cat("Отклоняем нулевую гипотезу в пользу альтернативной гипотезы. Вывод:", H1)
} else {
  cat("Принимаем нулевую гипотезу. Вывод:", H0)
}

# Выводим наблюдаемое значение статистики и критическое значение статистики
cat("\n\nНаблюдаемое значение статистики:", observed_value1)
cat("\nКритическое значение статистики:", critical_value1)

```

Создаём таблицу сопряжённости для 2ой выборки

```{r echo=TRUE}
contingency_table2 <- table(smokers2, lung_cancer2)
contingency_table2
```

Поскольку в некоторых ячейках таблицы меньше 5 элементов, то для проверки гипотезы о том, что курение влияет на развитие рака лёгких можно использовать точный критерий Фишера.

Для точного критерия Фишера вычисление критического значения статистики не является стандартной практикой, вместо этого используется непосредственное вычисление p-значения для оценки статистической значимости результатов.

```{r}

fisher_test2 <- fisher.test(contingency_table2)

cat("\nДля второй выборки:\n")

cat("p-значение для точного критерия Фишера:", fisher_test2$p.value, "\n")

# Оцениваем статистическую значимость
if (fisher_test2$p.value < alpha) {
  cat("Отклоняем нулевую гипотезу в пользу альтернативной гипотезы. Вывод:", H1)
} else {
  cat("Принимаем нулевую гипотезу. Вывод:", H0)
}

```

## Задание 3

Поскольку исследователь избегает любых допущений, кроме того, что выборки независимы и имеют одинаковое распределение, то, думаю, лучше не использовать нормальное распределение.

Поскольку данные не распределены нормально, для проверки гипотезы о том, что применение нового метода лечения синдрома раздражённого кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией, мы можем использовать только непараметрический тест. Подойдёт U-критерий Манна-Уитни (непараметрический аналог непарного t-теста).

В R мы не можем получить критическое значение статистики U, поэтому для оценки статистической значимости мы будем вычислять p-значение.

```{r}

# Задаём seed для воспроизводимости результатов
set.seed(290)

# Генерируем данные для двух групп пациентов с распределением Стьюдента
group1 <- rt(30, df = 10) # данные для группы с новым методом лечения
group2 <- rt(38, df = 10) # данные для группы с диетотерапией

# Формулируем нулевую и альтернативную гипотезу
H0 <- "Тип лечения синдрома раздражённого кишечника не влияет на уровень болевых симптомов."
H1 <- "Применение нового метода лечения синдрома раздражённого кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией."

# Определяем уровень значимости
alpha <- 0.05

# Выполним тест Уилкоксона-Манна-Уитни для проверки гипотезы
wilcox_test_result <- wilcox.test(group1, group2)

# Выводим результаты
print("Результаты теста Манна-Уитни:")
print(wilcox_test_result)

# Оцениваем статистическую значимость
if (wilcox_test_result$p.value < alpha) {
  cat("Отклоняем нулевую гипотезу в пользу альтернативной гипотезы. Вывод:", H1)
} else {
  cat("Принимаем нулевую гипотезу. Вывод:", H0)
}

```

## Задание 4

```{r}
# Задаём seed для воспроизводимости результатов
set.seed(12)

# Генерируем датасет

tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
  mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)

```

```{r}
head(tumor)
```

```{r echo=TRUE}
# Построим на одном графике три “ящика с усами” 

ggplot(tumor, aes(x = therapy, y = value)) +
  geom_boxplot() +
  labs(title = "Размер опухоли в трех группах мышей",
       x = "Противоопухолевая терапия",
       y = "Размер опухоли")


```

Перед проведенем дисперсионного анализа проверим данные на нормальность с помощью теста Шапиро-Уилка

```{r echo=TRUE}
shapiro_test_group0 <- shapiro.test(tumor$value[tumor$therapy == "0"])
shapiro_test_groupA <- shapiro.test(tumor$value[tumor$therapy == "A"])
shapiro_test_groupB <- shapiro.test(tumor$value[tumor$therapy == "B"])

# Выведем результаты
print("Тест Шапиро-Уилка для группы 0:")
print(shapiro_test_group0)

print("Тест Шапиро-Уилка для группы A:")
print(shapiro_test_groupA)

print("Тест Шапиро-Уилка для группы B:")
print(shapiro_test_groupB)
```

Поскольку р-значение теста Шапиро-Уилка для всех трёх выборок \>0.05, то распределение данных во всех выборках можно считать нормальным.

```{r echo=TRUE}
# Проверка на гомоскедастичность 
levene_test_result <- leveneTest(value ~ therapy, data = tumor)
print("Результаты теста Левена:")
print(levene_test_result)

```

р-значение теста Левана \> 0.05, следовательно, дисперсии выборок значимо не отличаются.

Все требования для использования дисперсионного анализа ANOVA выполняются.

```{r echo=TRUE}
# Проведем дисперсионный анализ
anova_result <- aov(value ~ therapy, data = tumor)
summary(anova_result)
```

p-значение \> 0.05, поэтому мы не можем отклонить нулевую гипотезу о равенстве средних размеров опухоли в трёх группах мышей.

Поскольку тест первого уровня не показал достовернух различий проводить post hoc тест не имеет смысла.

Если бы ANOVA показал достоверные различия, то проведение попарного сравнения выглядело бы следующим образом:

```{r echo=TRUE}
tukey_result <- TukeyHSD(anova_result, conf.level = 0.95)
tukey_result
```

Попарное сравнение выборок тоже не показало значимых различий в размерах опухолей между группами.
